<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reuniones - I.E. Ex. Mixto "La Molina" 1278</title>
    <link rel="stylesheet" href="assets/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="icon" href="favicon.ico" />
</head>
<body class="d-flex flex-column min-vh-100 bg-light">

    <!-- Header institucional -->
    <header>
        <!-- Barra superior con colores institucionales -->
        <div class="bg-primary-institution text-white py-2">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <small><i class="bi bi-geo-alt-fill me-2"></i>I.E. Ex. Mixto "La Molina" 1278 - APAFA 2026-2027</small>
                    </div>
                    <div class="col-md-6 text-end">
                        <small><i class="bi bi-telephone-fill me-2"></i>Contacto | <i class="bi bi-envelope-fill me-2"></i>Email</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navegaci√≥n principal -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-secondary-institution shadow">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
                    <span>I.E. Ex. Mixto "La Molina" 1278</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">
                                <i class="bi bi-house-door me-1"></i>Inicio
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="notificaciones.html">
                                <i class="bi bi-bell me-1"></i>Notificaciones
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="padres.html">
                                <i class="bi bi-people me-1"></i>Socios APAFA
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="reuniones.html">
                                <i class="bi bi-calendar-event me-1"></i>Reuniones
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="py-4">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div>
                                <h1 class="h2 fw-bold text-primary-institution mb-1">
                                    <i class="bi bi-calendar-event me-2"></i>Reuniones APAFA
                                </h1>
                                <p class="text-muted mb-0">Historial de reuniones y asistencia</p>
                            </div>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb mb-0">
                                    <li class="breadcrumb-item"><a href="index.html" class="text-decoration-none">Inicio</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Reuniones</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>

        <!-- Estad√≠sticas -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-4">
                                <h3 id="total-reuniones">Cargando...</h3>
                                <p class="text-muted">Total Reuniones</p>
                            </div>
                            <div class="col-md-4">
                                <h3 id="promedio-asistencia">Cargando...</h3>
                                <p class="text-muted">Promedio Asistencia</p>
                            </div>
                            <div class="col-md-4">
                                <h3 id="total-asistentes">Cargando...</h3>
                                <p class="text-muted">Total Asistentes</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de reuniones -->
        <div class="row" id="lista-reuniones">
            <!-- Las reuniones se cargar√°n aqu√≠ -->
        </div>

        <!-- Pr√≥xima reuni√≥n -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>üìÖ Pr√≥xima Reuni√≥n</h5>
                    </div>
                    <div class="card-body">
                        <h6 id="proxima-titulo">Cargando...</h6>
                        <p id="proxima-detalles">Cargando detalles...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <a href="reuniones.html" class="btn btn-primary">‚Üê Volver a versi√≥n completa</a>
            <a href="reuniones-simple.html" class="btn btn-secondary">‚Üê Ir a simple</a>
        </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-secondary-institution text-white py-4 mt-auto">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>I.E. Ex. Mixto "La Molina" 1278</h5>
                    <p class="mb-0">Comit√© de Padres de Familia - APAFA 2026-2027</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="mb-0">
                        <i class="bi bi-envelope me-2"></i>contacto@apafa-lamolina.edu.pe<br>
                        <i class="bi bi-telephone me-2"></i>(01) 123-4567
                    </p>
                </div>
            </div>
            <hr class="my-3">
            <div class="text-center">
                <small>&copy; 2026 I.E. Ex. Mixto "La Molina" 1278 - Todos los derechos reservados</small>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="assets/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Data loader -->
    <script src="assets/js/data-loader.js"></script>

    <!-- JavaScript simplificado -->
    <script>
        let datosReuniones = [];

        // Funci√≥n para renderizar estad√≠sticas
        function renderEstadisticas() {
            const total = datosReuniones.length;
            const totalAsistentes = datosReuniones.reduce((sum, r) => sum + r.asistentes, 0);
            const promedio = total > 0 ? Math.round(totalAsistentes / total) : 0;

            document.getElementById('total-reuniones').textContent = total;
            document.getElementById('promedio-asistencia').textContent = promedio;
            document.getElementById('total-asistentes').textContent = totalAsistentes;
        }

        // Funci√≥n para renderizar lista de reuniones
        function renderListaReuniones() {
            console.log('Renderizando lista de reuniones:', datosReuniones);
            if (!datosReuniones || datosReuniones.length === 0) {
                console.log('No hay reuniones para mostrar');
                document.getElementById('lista-reuniones').innerHTML = `
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body text-center">
                                <i class="bi bi-calendar-x text-muted" style="font-size: 3rem;"></i>
                                <h5 class="text-muted mt-3">No hay reuniones programadas</h5>
                                <p class="text-muted">Las reuniones aparecer√°n aqu√≠ cuando sean programadas por el comit√©.</p>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            console.log(`Generando HTML para ${datosReuniones.length} reuniones`);
            let html = '';
            datosReuniones.forEach(reunion => {
                const fecha = new Date(reunion.fecha).toLocaleDateString('es-PE', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                // Valores por defecto para campos que no existen en el JSON de eventos
                const asistentes = reunion.asistentes || 0;
                const totalPadres = reunion.total_padres || 6;

                html += `
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <div class="d-flex align-items-center">
                                    <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                                        <i class="bi bi-calendar-event-fill fs-5"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0 fw-bold">${reunion.titulo}</h6>
                                        <small class="opacity-75">
                                            <i class="bi bi-clock me-1"></i>${fecha} - ${reunion.hora}
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-text text-muted mb-3">${reunion.descripcion || 'Reuni√≥n programada por el comit√© APAFA'}</p>

                                <div class="row text-center">
                                    <div class="col-6">
                                        <div class="bg-success bg-opacity-10 p-2 rounded">
                                            <strong>${asistentes}</strong><br>
                                            <small>Asistieron</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-info bg-opacity-10 p-2 rounded">
                                            <strong>${totalPadres}</strong><br>
                                            <small>Total Padres</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            console.log('Insertando HTML en lista-reuniones');
            document.getElementById('lista-reuniones').innerHTML = html;
        }

        // Funci√≥n para renderizar pr√≥xima reuni√≥n
        function renderProximaReunion() {
            console.log('Renderizando pr√≥xima reuni√≥n');
            if (!datosReuniones || datosReuniones.length === 0) {
                console.log('No hay reuniones para mostrar como pr√≥xima');
                document.getElementById('proxima-titulo').textContent = 'No hay reuniones programadas';
                document.getElementById('proxima-detalles').textContent = '';
                return;
            }

            // Tomar la primera reuni√≥n como "pr√≥xima"
            const proxima = datosReuniones[0];
            const fecha = new Date(proxima.fecha).toLocaleDateString('es-PE', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const lugar = proxima.lugar || 'Auditorio Principal';

            console.log('Mostrando pr√≥xima reuni√≥n:', proxima.titulo);
            document.getElementById('proxima-titulo').textContent = proxima.titulo;
            document.getElementById('proxima-detalles').innerHTML = `
                <strong>Fecha:</strong> ${fecha}<br>
                <strong>Hora:</strong> ${proxima.hora}<br>
                <strong>Lugar:</strong> ${lugar}
            `;
        }

        // Carga de datos
        async function loadReunionesData() {
            try {
                console.log('Cargando datos de eventos para filtrar reuniones...');
                const eventosData = await ApafaData.loadDataWithFallback('eventos', { eventos: [] });
                console.log('Datos de eventos cargados:', eventosData);

                const reuniones = eventosData.eventos.filter(evento => evento.tipo === 'reunion');
                console.log('Eventos filtrados por tipo "reunion":', reuniones);
                console.log(`Total de reuniones encontradas: ${reuniones.length}`);

                return { reuniones };
            } catch (error) {
                console.error('Error cargando reuniones:', error);
                throw error;
            }
        }

        // Funci√≥n principal
        async function cargarDatosReuniones() {
            try {
                console.log('Cargando datos de reuniones...');
                const { reuniones } = await loadReunionesData();
                datosReuniones = reuniones;

                console.log('Datos cargados:', reuniones.length, 'reuniones');

                // Renderizar todo
                renderEstadisticas();
                renderListaReuniones();
                renderProximaReunion();

                console.log('Reuniones renderizadas correctamente');

            } catch (error) {
                console.error('Error cargando reuniones:', error);

                // Mostrar errores
                document.getElementById('total-reuniones').textContent = 'Error';
                document.getElementById('lista-reuniones').innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-danger text-center">
                            Error cargando reuniones: ${error.message}
                        </div>
                    </div>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', cargarDatosReuniones);
    </script>
</body>
</html>